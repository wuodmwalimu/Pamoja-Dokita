<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashier Clearance | Pamoja DokitaÂ® 2025</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://kit.fontawesome.com/YOUR_FONTAWESOME_KIT.js" crossorigin="anonymous"></script>
  <style>
 /* General Page Styles */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: #fff;
    color: #333;
}

/* Header */
header {
    background: #b30000; /* Blood Red */
    color: #fff;
    padding: 15px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
}

nav {
    text-align: center;
    margin-top: 10px;
}

nav a {
    color: white;
    text-decoration: none;
    padding: 10px 20px;
    font-weight: bold;
    background: #800000;
    border-radius: 5px;
    transition: 0.3s;
}

nav a:hover {
    background: #ff4d4d;
}

/* Card Sections */
.card {
    background: #fff;
    padding: 20px;
    margin: 20px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

/* Table Container for Horizontal Scroll */
.card {
    overflow-x: auto;
    white-space: nowrap;
    max-width: 100%;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

th, td {
    padding: 12px;
    border: 1px solid #ddd;
    text-align: center;
}

/* Table Headers */
th {
    background: #b30000;
    color: white;
    font-weight: bold;
}

/* Table Rows */
tr:nth-child(even) {
    background: #f9f9f9;
}

/* Buttons */
button {
    background: #b30000;
    color: white;
    border: none;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 5px;
    transition: 0.3s;
}

button:hover {
    background: #ff4d4d;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    z-index: 10;
}

.modal-content {
    text-align: center;
}

/* Footer */
footer {
    background: #b30000;
    color: white;
    text-align: center;
    padding: 10px;
    position: relative;
    bottom: 0;
    width: 100%;
}

/* Responsive Design */
@media screen and (max-width: 768px) {
    .card {
        padding: 15px;
    }

    table {
        min-width: 600px;
    }
}

@media screen and (max-width: 480px) {
    table {
        min-width: 500px;
    }
    }
  </style>
  
  
</head>
<body>

<header>
    <h1 id="welcomeMessage"><span id="welcomeText"></span></h1>
    <nav>
        <a href="/main"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    </nav>
</header>

  
  
  
<!-- Approved Requests -->
<section class="card">
    <h2><i class="fas fa-check-circle"></i> Approved Requests</h2>
  
  
  
  <div class="table-controls">
    <input type="text" id="searchInput" placeholder="Search...">
    
    <select id="bloodTypeFilter">
        <option value="all">All Blood Types</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
    </select>

   <select id="hospitalFilter">
    <option value="all">All Hospitals</option>
</select>

<select id="cashierFilter">
    <option value="all">All Cashiers</option>
    </select>
    <select id="recordsPerPage">
        <option value="5">5 per page</option>
        <option value="10" selected>10 per page</option>
        <option value="20">20 per page</option>
        <option value="50">50 per page</option>
    </select>

    <button id="exportCsv">Export to CSV</button>
  </div>
  
  
  
  
  
  
  
  
  
  
  
    <table id="approvedRequestsTable" class="filterable-table">
        <thead>
            <tr>
                <th>Recipient</th>
                <th>Blood Type</th>
                <th>Units</th>
                <th>Hospital</th>
                <th>Doctor</th>
                <th>Approved Date</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <% approvedRequests.forEach(request => { %>
                <tr data-id="<%= request.id %>">
                    <td><%= request.recipientName %></td>
                    <td><%= request.bloodType %></td>
                    <td><%= request.units %></td>
                    <td><%= request.hospital %></td>
                    <td><%= request.doctor %></td>
                    <td><%= request.approvedDate %></td>
                    <td class="status">ðŸ’°â˜’</td>
                    <td>
                        <button class="cashier-btn" data-id="<%= request.id %>">
                            <i class="fas fa-money-check-alt"></i> Clear
                        </button>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>
          <div class="pagination-container">
            <div class="pagination"></div>
</section>

<!-- Cleared Requests -->
<section class="card">
    <h2><i class="fas fa-file-invoice-dollar"></i> Cleared Requests</h2>
    <table id="clearedRequestsTable" class="filterable-table">
        <thead>
            <tr>
                <th>Recipient</th>
                <th>Blood Type</th>
                <th>Units</th>
                <th>Hospital</th>
                <th>Doctor</th>
                <th>Approved Date</th>
                <th>Cashier Name</th>
                <th>Timestamp</th>
                <th>Status</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            <% cashierCleared.forEach(request => { %>
                <tr>
                    <td><%= request.recipientName %></td>
                    <td><%= request.bloodType %></td>
                    <td><%= request.units %></td>
                    <td><%= request.hospital %></td>
                    <td><%= request.doctor %></td>
                    <td><%= request.approvedDate %></td>
                    <td><%= request.cashierName %></td>
                    <td><%= request.timestamp %></td>
                    <td>ðŸ’°âœ…</td>
                    <td><%= request.additionalNotes %></td>
                </tr>
            <% }); %>
        </tbody>
    </table>
          <div class="pagination-container">
    <div class="pagination"></div>
</section>

  
  
  
  
<!-- Cashier Clearance Modal -->
<div id="cashierModal" class="modal">
    <div class="modal-content">
        <h3>Cashier Clearance</h3>
        <p><strong>Recipient:</strong> <span id="modalRecipient"></span></p>
        <p><strong>Blood Type:</strong> <span id="modalBloodType"></span></p>
        <p><strong>Units:</strong> <span id="modalUnits"></span></p>
        <label for="cashierNotes">Notes (Optional):</label>
        <textarea id="cashierNotes"></textarea>
        <button id="confirmClearance">Confirm</button>
        <button id="closeModal">Cancel</button>
    </div>
</div>

<footer>
    <p>Â© 2025 Charles Drew Pamoja DokitaÂ® | All Rights Reserved</p>
</footer>

<script>

  
  
  
  
  document.addEventListener("DOMContentLoaded", () => {
    const user = JSON.parse(localStorage.getItem("user")) || {};
    let cashierEmail = user.email || "Unknown Cashier";
    let cashierName = cashierEmail.split("@")[0]?.replace(".", " ") || "Unknown Cashier";
    cashierName = cashierName.split(" ").map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");

    const welcomeText = document.getElementById("welcomeText");
    welcomeText.innerHTML = user.email
        ? `Welcome, ${user.role || "User"} <strong>${cashierName}</strong>! 
           Youâ€™re now part of <strong>${user.hospital || "Unknown"}</strong> in <strong>${user.region || "Unknown"}</strong>.`
        : "Welcome to Pamoja DokitaÂ® 2025!";

    // Select elements
    const searchInput = document.getElementById("searchInput");
    const bloodTypeFilter = document.getElementById("bloodTypeFilter");
    const hospitalFilter = document.getElementById("hospitalFilter");
    const cashierFilter = document.getElementById("cashierFilter");
    const recordsPerPageSelect = document.getElementById("recordsPerPage");
    const tables = document.querySelectorAll(".filterable-table");

    let currentPage = 1;
    let rowsPerPage = parseInt(recordsPerPageSelect.value, 10);

    // Event listeners
    [searchInput, bloodTypeFilter, hospitalFilter, cashierFilter, recordsPerPageSelect].forEach(input =>
        input.addEventListener("input", updateTable)
    );

    document.querySelectorAll("th").forEach((header, index) => {
        header.style.cursor = "pointer";
        header.addEventListener("click", () => sortTable(index, header.closest("table")));
    });

    function updateTable() {
        tables.forEach(table => {
            const tbody = table.querySelector("tbody");
            let rows = Array.from(tbody.rows);

            let filteredRows = filterRows(rows);
            paginateTable(filteredRows, table);
        });
    }

    
    
    
    function filterRows(rows) {
    const searchText = searchInput.value.toLowerCase();
    const bloodType = bloodTypeFilter.value.toLowerCase();
    const Hospital = hospitalFilter.value.toLowerCase();
    const Cashier Name = cashierFilter.value.toLowerCase(); // Uses cashierName

    if (!rows.length) return []; // Return empty if no rows

    // Get column indexes dynamically
    const table = rows[0]?.closest("table");
    const headers = Array.from(table?.querySelectorAll("th") || []);
    
    const columnIndexes = {
    hospital: headers.findIndex(th => th.innerText.trim().toLowerCase() === "hospital"),
    cashierName: headers.findIndex(th => th.innerText.trim().toLowerCase() === "cashier name"), // Fix space issue
    bloodType: headers.findIndex(th => th.innerText.trim().toLowerCase() === "blood type"),
};
      
      
    return rows.filter(row => {
        const rowText = row.innerText.toLowerCase();
        
        const rowData = {
            bloodType: columnIndexes.bloodType !== -1 ? row.cells[columnIndexes.bloodType]?.innerText.toLowerCase() : "",
            hospital: columnIndexes.hospital !== -1 ? row.cells[columnIndexes.hospital]?.innerText.toLowerCase() : "",
            cashierName: columnIndexes.cashierName !== -1 ? row.cells[columnIndexes.cashierName]?.innerText.toLowerCase() : "",
        };

        return (bloodType === "all" || rowData.bloodType === bloodType) &&
               (hospital === "all" || rowData.hospital === hospital) &&
               (cashierName === "all" || rowData.cashierName === cashierName) &&
               (searchText === "" || rowText.includes(searchText));
    });
    }
    
    
    
    
    
    
    
    
    function sortTable(colIndex, table) {
        const tbody = table.querySelector("tbody");
        let rows = Array.from(tbody.rows);

        const isAscending = table.dataset.sortOrder !== "asc";
        table.dataset.sortOrder = isAscending ? "asc" : "desc";

        rows.sort((rowA, rowB) => {
            let cellA = rowA.cells[colIndex]?.innerText.trim().toLowerCase();
            let cellB = rowB.cells[colIndex]?.innerText.trim().toLowerCase();

            if (!isNaN(cellA) && !isNaN(cellB)) {
                return isAscending ? cellA - cellB : cellB - cellA;
            }
            return isAscending ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
        });

        rows.forEach(row => tbody.appendChild(row));
        updateTable();
    }

    function paginateTable(rows, table) {
        const tbody = table.querySelector("tbody");
        const paginationContainer = table.nextElementSibling.querySelector(".pagination");
        tbody.innerHTML = "";

        const totalPages = Math.ceil(rows.length / rowsPerPage);
        currentPage = Math.max(1, Math.min(currentPage, totalPages));

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        rows.slice(start, end).forEach(row => tbody.appendChild(row));

        updatePaginationControls(paginationContainer, totalPages);
    }

    function updatePaginationControls(container, totalPages) {
        container.innerHTML = "";
        if (totalPages <= 1) return;

        const createButton = (text, page) => {
            const btn = document.createElement("button");
            btn.innerText = text;
            btn.classList.add("page-btn");
            if (page === currentPage) btn.classList.add("active");
            btn.addEventListener("click", () => {
                currentPage = page;
                updateTable();
            });
            return btn;
        };

        container.appendChild(createButton("First", 1));
        container.appendChild(createButton("Previous", Math.max(1, currentPage - 1)));

        if (totalPages <= 7) {
            for (let i = 1; i <= totalPages; i++) {
                container.appendChild(createButton(i, i));
            }
        } else {
            if (currentPage > 3) container.appendChild(createButton("1", 1));
            if (currentPage > 4) container.appendChild(createButton("...", currentPage - 2));

            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                container.appendChild(createButton(i, i));
            }

            if (currentPage < totalPages - 3) container.appendChild(createButton("...", currentPage + 2));
            if (currentPage < totalPages - 2) container.appendChild(createButton(totalPages, totalPages));
        }

        container.appendChild(createButton("Next", Math.min(totalPages, currentPage + 1)));
        container.appendChild(createButton("Last", totalPages));
    }

    document.getElementById("exportCsv").addEventListener("click", () => exportToCSV());

    function exportToCSV() {
        let csvContent = "data:text/csv;charset=utf-8,";
        tables.forEach(table => {
            csvContent += Array.from(table.rows).map(row =>
                Array.from(row.cells).map(cell => `"${cell.innerText}"`).join(",")
            ).join("\n") + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "table_data.csv");
        document.body.appendChild(link);
        link.click();
    }

    updateTable();
});
  
  
  
  
</script>

</body>
  </html>